# 功能验证清单

本文档用于验证 v1.2.0 版本的所有新功能是否正常工作。

## ✅ 已实现的功能

### 1. 智能上下文管理

- [x] 按行数获取上下文（`mode: 'lines'`）
- [x] 按字符数获取上下文（`mode: 'chars'`）
- [x] 可配置发送前 N 行（`maxLines: 0-N`）
- [x] 自动截断超长文本（`maxChars`）
- [x] `maxLines: 0` 只发送当前行

**测试方法**：
1. 设置 `maxLines: 0`，输入多行文本，验证只发送当前行
2. 设置 `maxLines: 3`，输入多行文本，验证发送前3行+当前行
3. 设置 `maxChars: 100`，输入长文本，验证自动截断

### 2. 差异化防抖延迟

- [x] 正常编写延迟（`debounce.normal: 500ms`）
- [x] 换行时延迟（`debounce.newLine: 200ms`）
- [x] 粘贴后延迟（`debounce.paste: 1000ms`）
- [x] 自动检测换行事件
- [x] 自动检测粘贴事件

**测试方法**：
1. 正常输入文字，观察 500ms 后触发补全
2. 按回车换行，观察 200ms 后快速触发补全
3. Ctrl+V 粘贴文字，观察 1000ms 后触发补全
4. 查看控制台日志确认事件检测

### 3. 智能触发条件

- [x] 换行时快速触发（`trigger.onNewLine: true`）
- [x] 标点符号后不触发（`trigger.skipAfterPunctuation`）
- [x] 可自定义跳过的标点符号列表
- [x] 控制台日志提示跳过原因

**测试方法**：
1. 输入句号（。或.），验证不触发补全
2. 输入问号（？或?），验证不触发补全
3. 输入感叹号（！或!），验证不触发补全
4. 输入分号（；或;），验证不触发补全
5. 输入其他字符，验证正常触发补全
6. 查看控制台日志确认跳过信息

### 4. 配置结构优化

- [x] 新增 `AutoCompleteConfig` 接口
- [x] 统一配置到 `autoComplete` 节点
- [x] 更新 `config.local.ts`
- [x] 更新 `config.local.example.ts`
- [x] 类型检查通过
- [x] 构建成功

## 🧪 测试场景

### 场景 1：正常编写文本

**步骤**：
1. 打开编辑器
2. 输入 "今天天气"
3. 停止输入，等待 500ms

**预期结果**：
- 500ms 后触发补全
- 显示灰色幽灵文字
- 按 Tab 接受补全

### 场景 2：换行触发

**步骤**：
1. 输入 "第一行文字"
2. 按回车换行
3. 等待 200ms

**预期结果**：
- 200ms 后快速触发补全
- 控制台显示 "检测到换行，使用快速触发"
- 显示补全建议

### 场景 3：标点符号过滤

**步骤**：
1. 输入 "这是一个句子。"
2. 等待

**预期结果**：
- 不触发补全
- 控制台显示 "跳过触发：光标前是标点符号 。"

### 场景 4：粘贴文本

**步骤**：
1. 复制一段文字
2. Ctrl+V 粘贴
3. 等待 1000ms

**预期结果**：
- 1000ms 后触发补全
- 控制台显示 "检测到粘贴，使用延迟触发"
- 给用户时间调整粘贴内容

### 场景 5：上下文限制

**配置**：`maxLines: 0, maxChars: 500`

**步骤**：
1. 输入多行文字（超过5行）
2. 在最后一行输入
3. 查看发送的请求内容

**预期结果**：
- 只发送当前行内容
- 不包含前面的行

### 场景 6：上下文包含前几行

**配置**：`maxLines: 3, maxChars: 500`

**步骤**：
1. 输入多行文字（超过5行）
2. 在最后一行输入
3. 查看发送的请求内容

**预期结果**：
- 发送前3行 + 当前行
- 总字符数不超过 500

## 📊 性能指标

### Token 使用对比

| 场景 | 旧版本 | 新版本 (maxLines: 0) | 新版本 (maxLines: 3) | 节省比例 |
|------|--------|---------------------|---------------------|---------|
| 10行文本 | ~500 tokens | ~50 tokens | ~150 tokens | 90% / 70% |
| 50行文本 | ~2500 tokens | ~50 tokens | ~150 tokens | 98% / 94% |
| 100行文本 | ~5000 tokens | ~50 tokens | ~150 tokens | 99% / 97% |

### 响应速度对比

| 场景 | 延迟时间 | 说明 |
|------|---------|------|
| 正常编写 | 500ms | 平衡响应速度和请求频率 |
| 换行时 | 200ms | 快速响应，提升体验 |
| 粘贴后 | 1000ms | 给用户调整时间 |
| 标点后 | 不触发 | 节省不必要的请求 |

## 🐛 已知问题

目前没有已知问题。

## 📝 待优化项

1. 支持运行时动态配置（不需要重启）
2. 添加配置 UI 界面
3. 支持更多触发条件（如特定关键字后触发）
4. 支持自定义触发规则（正则表达式）
5. 添加补全质量统计和分析

## 🔗 相关文档

- [自动补全优化说明](./AUTOCOMPLETE_OPTIMIZATION.md)
- [配置说明](../README.md#配置选项)
- [更新日志](../CHANGELOG.md)
