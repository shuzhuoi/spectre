# 测试指南 - v1.2.0

本文档提供详细的测试步骤，用于验证 v1.2.0 版本的所有功能。

## 准备工作

1. 确保已配置 `src/api/config.local.ts`
2. 启动开发服务器：`pnpm dev`
3. 打开浏览器控制台（F12）查看日志

---

## 测试 1: maxLines 配置测试

### 测试 1.1: maxLines = 0（只发送当前行）

**配置**：
```typescript
context: {
  mode: 'lines',
  maxLines: 0,
  maxChars: 500
}
```

**步骤**：
1. 输入以下内容（每行按回车）：
   ```
   第一行文字
   第二行文字
   第三行文字
   第四行
   ```
2. 在第四行后面继续输入 "内容"
3. 等待补全触发

**验证**：
- 打开浏览器开发者工具 → Network
- 查看发送的请求 payload
- 应该只包含 "第四行内容"，不包含前三行

**预期结果**：✅ 只发送当前行

---

### 测试 1.2: maxLines = 3（发送前3行+当前行）

**配置**：
```typescript
context: {
  mode: 'lines',
  maxLines: 3,
  maxChars: 500
}
```

**步骤**：
1. 输入以下内容：
   ```
   第一行
   第二行
   第三行
   第四行
   第五行
   第六行
   ```
2. 在第六行后面继续输入

**验证**：
- 查看请求 payload
- 应该包含：第三行、第四行、第五行、第六行（前3行+当前行）
- 不包含第一行、第二行

**预期结果**：✅ 发送前3行+当前行

---

## 测试 2: 防抖延迟测试

### 测试 2.1: 正常编写延迟

**配置**：
```typescript
debounce: {
  normal: 500,
  newLine: 200,
  paste: 1000
}
```

**步骤**：
1. 输入 "今天天气"
2. 停止输入
3. 观察控制台和补全出现时间

**验证**：
- 大约 500ms 后出现补全
- 控制台没有 "检测到换行" 或 "检测到粘贴" 日志

**预期结果**：✅ 500ms 后触发

---

### 测试 2.2: 换行快速触发

**步骤**：
1. 输入 "第一行"
2. 按回车换行
3. 观察补全出现时间

**验证**：
- 控制台显示 "[AiEditor] 检测到换行，使用快速触发"
- 大约 200ms 后出现补全（比正常快）

**预期结果**：✅ 200ms 后快速触发

---

### 测试 2.3: 粘贴延迟触发

**步骤**：
1. 复制一段文字（如 "这是粘贴的内容"）
2. Ctrl+V 粘贴
3. 观察补全出现时间

**验证**：
- 控制台显示 "[AiEditor] 检测到粘贴，使用延迟触发"
- 大约 1000ms 后出现补全（比正常慢）

**预期结果**：✅ 1000ms 后触发

---

## 测试 3: 标点符号过滤测试

### 测试 3.1: 句号后不触发

**配置**：
```typescript
trigger: {
  onNewLine: true,
  skipAfterPunctuation: ['。', '.', '!', '?', '！', '？', '；', ';']
}
```

**步骤**：
1. 输入 "这是一个句子。"
2. 等待 1 秒

**验证**：
- 控制台显示 "[AiEditor] 跳过触发：光标前是标点符号 。"
- 不出现补全建议

**预期结果**：✅ 不触发补全

---

### 测试 3.2: 其他标点测试

**步骤**：
依次测试以下输入：
- "这是问题？" → 不触发
- "太好了！" → 不触发
- "第一点；" → 不触发
- "Hello." → 不触发
- "What?" → 不触发

**预期结果**：✅ 所有配置的标点都不触发

---

### 测试 3.3: 非标点正常触发

**步骤**：
1. 输入 "今天天气很"
2. 等待

**验证**：
- 没有跳过日志
- 正常出现补全

**预期结果**：✅ 正常触发

---

## 测试 4: Bug 修复验证

### 测试 4.1: 快速换行不触发多条

**步骤**：
1. 打开 Network 面板
2. 快速连续按回车 5 次
3. 观察网络请求数量

**验证**：
- 控制台显示 5 次 "检测到换行"
- 但只发送 1 次 API 请求（最后一次）
- 之前的请求被取消

**预期结果**：✅ 只触发 1 次请求

---

### 测试 4.2: 快速输入取消之前的请求

**步骤**：
1. 输入 "今天"
2. 立即继续输入 "天气"
3. 再输入 "很好"
4. 观察请求

**验证**：
- 只有最后一次输入触发请求
- 之前的请求被取消

**预期结果**：✅ 只保留最后一次请求

---

## 测试 5: 综合场景测试

### 场景 1: 写文章

**步骤**：
1. 输入第一段文字
2. 按回车换行（快速触发）
3. 输入句号（不触发）
4. 继续输入（正常触发）

**预期**：
- 换行时快速补全
- 句号后不补全
- 其他时候正常补全

---

### 场景 2: 写代码

**配置**：
```typescript
context: { maxLines: 5 }
trigger: { skipAfterPunctuation: [';', '}'] }
```

**步骤**：
1. 输入函数定义
2. 按回车换行
3. 输入代码行
4. 输入分号

**预期**：
- 换行快速补全
- 分号后不补全
- 包含前几行上下文

---

### 场景 3: 粘贴大段文本

**步骤**：
1. 复制一大段文字（100+ 字）
2. Ctrl+V 粘贴
3. 立即修改部分内容
4. 等待补全

**预期**：
- 粘贴后延迟 1000ms
- 给用户时间调整
- 然后正常补全

---

## 性能测试

### 测试 1: Token 使用对比

**配置 A**：`maxLines: 0`
**配置 B**：`maxLines: 3`

**步骤**：
1. 输入 50 行文字
2. 在最后一行触发补全
3. 对比发送的文本长度

**预期**：
- 配置 A：只发送当前行（~50 字符）
- 配置 B：发送 4 行（~200 字符）
- Token 节省：75%

---

### 测试 2: 响应速度对比

**测试不同延迟配置**：
- normal: 300ms vs 500ms vs 800ms
- newLine: 100ms vs 200ms vs 300ms

**观察**：
- 延迟越短，响应越快，但请求越频繁
- 延迟越长，响应越慢，但请求越少
- 推荐：normal=500ms, newLine=200ms

---

## 问题排查

### 问题 1: 没有补全出现

**检查**：
1. 配置文件是否正确
2. API Key 是否有效
3. 控制台是否有错误
4. 文本长度是否达到 minTriggerLength

---

### 问题 2: 补全太慢

**检查**：
1. debounce 延迟是否太长
2. 网络是否正常
3. API 服务是否响应慢

---

### 问题 3: 触发太频繁

**检查**：
1. debounce 延迟是否太短
2. 是否配置了标点过滤
3. 是否有请求取消机制

---

## 测试报告模板

```markdown
## 测试报告 - v1.2.0

**测试日期**：2026-01-07
**测试人员**：[姓名]
**环境**：Chrome 120 / Windows 11

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| maxLines = 0 | ✅ | 正常 |
| maxLines = 3 | ✅ | 正常 |
| 正常延迟 | ✅ | 500ms |
| 换行延迟 | ✅ | 200ms |
| 粘贴延迟 | ✅ | 1000ms |
| 标点过滤 | ✅ | 正常 |
| 快速换行 | ✅ | 不重复 |
| 请求取消 | ✅ | 正常 |

### 发现的问题

无

### 建议

无
```

---

## 自动化测试（未来）

计划添加：
- 单元测试（Jest/Vitest）
- E2E 测试（Playwright）
- 性能测试（Lighthouse）

---

**文档版本**：v1.2.0  
**最后更新**：2026-01-07
